
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Profiles in Pynbody &#8212; pynbody 0.46 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.46',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Plotting Rotation Cuves" href="rotation_curve.html" />
    <link rel="prev" title="Tracing Particles between Snapshots" href="bridge.html" />

   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

<link href="https://fonts.googleapis.com/css?family=Quicksand" rel="stylesheet">
<link href="_static/customise.css" rel="stylesheet">
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-38063425-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="profiles-in-pynbody">
<h1>Profiles in Pynbody<a class="headerlink" href="#profiles-in-pynbody" title="Permalink to this headline">¶</a></h1>
<div class="section" id="radial-density-profile">
<h2>Radial Density Profile<a class="headerlink" href="#radial-density-profile" title="Permalink to this headline">¶</a></h2>
<p>Making profiles of all kinds of quantities is easy – here’s a simple
example that shows how to plot a density profile:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pynbody</span>
<span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="c1"># load the snapshot and set to physical units</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;testdata/g15784.lr.01024.gz&#39;</span><span class="p">)</span>

<span class="c1"># load the halos</span>
<span class="n">h</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">halos</span><span class="p">()</span>

<span class="c1"># center on the largest halo and align the disk</span>
<span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">angmom</span><span class="o">.</span><span class="n">faceon</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="c1"># convert all units to something reasonable (kpc, Msol etc)</span>
<span class="n">s</span><span class="o">.</span><span class="n">physical_units</span><span class="p">()</span>

<span class="c1"># create a profile object for the stars (by default this is a 2D profile)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span><span class="nb">min</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

<span class="c1"># make the figure and sub plots</span>
<span class="n">f</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># make the plot</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;R [kpc]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Sigma_{\star}$ [M$_{\odot}$ kpc$^{-2}$]&#39;</span><span class="p">)</span>

<span class="c1"># make a 3D density plot of the dark matter (note ndim=3 in the constructor below)</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span><span class="nb">min</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span><span class="nb">max</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">ndim</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">semilogy</span><span class="p">()</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;R [kpc]&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{DM}$ [M$_{\odot}$ kpc$^{-3}$]&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>(<a class="reference external" href="../tutorials/example_code/density_profile.py">Source code</a>, <a class="reference external" href="../tutorials/example_code/density_profile.png">png</a>, <a class="reference external" href="../tutorials/example_code/density_profile.hires.png">hires.png</a>, <a class="reference external" href="../tutorials/example_code/density_profile.pdf">pdf</a>)</p>
<div class="figure">
<img alt="../_images/density_profile.png" src="../_images/density_profile.png" />
</div>
<p>Below is a more extended description of the
<a class="reference internal" href="../reference/analysis.html#module-pynbody.analysis.profile" title="pynbody.analysis.profile"><code class="xref py py-mod docutils literal"><span class="pre">profile</span></code></a> module.</p>
</div>
<div class="section" id="the-profile-class">
<h2>The Profile Class<a class="headerlink" href="#the-profile-class" title="Permalink to this headline">¶</a></h2>
<p>The <a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile" title="pynbody.analysis.profile.Profile"><code class="xref py py-class docutils literal"><span class="pre">Profile</span></code></a> class is meant to be a
general-purpose class to satisfy (almost) all simulation profiling
needs. Profiles are the most elementary ways to begin analyzing a
simulation, so the <a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile" title="pynbody.analysis.profile.Profile"><code class="xref py py-class docutils literal"><span class="pre">Profile</span></code></a> class is
designed to be an extension of the syntax implemented in the
<a class="reference internal" href="../reference/essentials.html#pynbody.snapshot.SimSnap" title="pynbody.snapshot.SimSnap"><code class="xref py py-class docutils literal"><span class="pre">SimSnap</span></code></a> class and its derivatives.</p>
<p>Creating a <a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile" title="pynbody.analysis.profile.Profile"><code class="xref py py-class docutils literal"><span class="pre">Profile</span></code></a> instance simply
defines the bins etc. Importantly, it also stores lists of particle
indices corresponding to each bin, so you can easily identify where
the particles belong.</p>
<p>Let’s quickly load a snapshot:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">pynbody</span><span class="p">;</span> <span class="kn">from</span> <span class="nn">pynbody.analysis</span> <span class="kn">import</span> <span class="n">profile</span><span class="p">;</span> <span class="kn">import</span> <span class="nn">matplotlib.pylab</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="gp">In [2]: </span><span class="n">s</span> <span class="o">=</span> <span class="n">pynbody</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;testdata/g15784.lr.01024&#39;</span><span class="p">);</span> <span class="n">s</span><span class="o">.</span><span class="n">physical_units</span><span class="p">()</span>

<span class="gp">In [3]: </span><span class="n">h</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">halos</span><span class="p">()</span>

<span class="gp">In [4]: </span><span class="n">pynbody</span><span class="o">.</span><span class="n">analysis</span><span class="o">.</span><span class="n">angmom</span><span class="o">.</span><span class="n">faceon</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="gh">Out[4]: </span><span class="go">&lt;pynbody.transformation.GenericRotation at 0x1812c16c10&gt;</span>
</pre></div>
</div>
<p>We’re centered on the main halo (as in the cookbook example above) and
we make the <a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile" title="pynbody.analysis.profile.Profile"><code class="xref py py-class docutils literal"><span class="pre">Profile</span></code></a> instance:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="s1">&#39;.01 kpc&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="s1">&#39;50 kpc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>With the default parameters, the profile is made in the xy-plane. To
make a spherically-symmetric 3D profile, specify <code class="docutils literal"><span class="pre">ndim=3</span></code> when
creating the profile.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [6]: </span><span class="n">pdm_sph</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">d</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="s1">&#39;.01 kpc&#39;</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="s1">&#39;250 kpc&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Even though we use <code class="docutils literal"><span class="pre">s.d</span></code> here (i.e. the full snapshot, not
just halo 1), the whole snapshot is still centered on halo 1.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You can pass unit strings to <code class="docutils literal"><span class="pre">min</span></code> and <code class="docutils literal"><span class="pre">max</span></code> and the
conversion will be done automatically into whatever the current
units of the snapshot are so you don’t have to explicitly do any unit conversions.</p>
</div>
</div>
<div class="section" id="automatically-generated-profiles">
<h2>Automatically-generated profiles<a class="headerlink" href="#automatically-generated-profiles" title="Permalink to this headline">¶</a></h2>
<p>Many profiling functions are already implemented – see the
<a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile" title="pynbody.analysis.profile.Profile"><code class="xref py py-class docutils literal"><span class="pre">Profile</span></code></a> documentation for a full
list with brief descriptions. You can also check the available
profiles in your session using
<a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile.derivable_keys" title="pynbody.analysis.profile.Profile.derivable_keys"><code class="xref py py-func docutils literal"><span class="pre">derivable_keys()</span></code></a> just like you
would for a <a class="reference internal" href="../reference/essentials.html#pynbody.snapshot.SimSnap" title="pynbody.snapshot.SimSnap"><code class="xref py py-class docutils literal"><span class="pre">SimSnap</span></code></a>:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [7]: </span><span class="n">p</span><span class="o">.</span><span class="n">derivable_keys</span><span class="p">()</span>
<span class="gh">Out[7]: </span><span class="go"></span>
<span class="go">[&#39;mass_enc&#39;,</span>
<span class="go"> &#39;pot&#39;,</span>
<span class="go"> &#39;j_theta&#39;,</span>
<span class="go"> &#39;weight_fn&#39;,</span>
<span class="go"> &#39;magnitudes&#39;,</span>
<span class="go"> &#39;density_enc&#39;,</span>
<span class="go"> &#39;j_phi&#39;,</span>
<span class="go"> &#39;E_circ&#39;,</span>
<span class="go"> &#39;density&#39;,</span>
<span class="go"> &#39;pattern_frequency&#39;,</span>
<span class="go"> &#39;g_spherical&#39;,</span>
<span class="go"> &#39;j_circ&#39;,</span>
<span class="go"> &#39;v_circ&#39;,</span>
<span class="go"> &#39;Q&#39;,</span>
<span class="go"> &#39;beta&#39;,</span>
<span class="go"> &#39;jtot&#39;,</span>
<span class="go"> &#39;X&#39;,</span>
<span class="go"> &#39;omega&#39;,</span>
<span class="go"> &#39;kappa&#39;,</span>
<span class="go"> &#39;dyntime&#39;,</span>
<span class="go"> &#39;mass&#39;,</span>
<span class="go"> &#39;sb&#39;,</span>
<span class="go"> &#39;fourier&#39;,</span>
<span class="go"> &#39;rotation_curve_spherical&#39;]</span>
</pre></div>
</div>
<p>Additionally, <em>any</em> existing array can be ‘profiled’. For example, if
the metallicity [Fe/H] is a derived field stored under ‘feh’, then
plotting a metallicity profile is as simple as:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [8]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s1">&#39;kpc&#39;</span><span class="p">),</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;feh&#39;</span><span class="p">],</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="gh">Out[8]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x1c2638fc50&gt;]</span>

<span class="gp">In [9]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$R$ [kpc]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;[Fe/H]&#39;</span><span class="p">)</span>
<span class="gh">Out[9]: </span><span class="go">Text(0,0.5,&#39;[Fe/H]&#39;)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/profile_fig1.png"><img alt="../_images/profile_fig1.png" src="../_images/profile_fig1.png" style="width: 5in;" /></a>
<p>If the array doesn’t exist but is deriveable (check with
<code class="docutils literal"><span class="pre">s.derivable_keys()</span></code>), it is automatically calculated.</p>
<p>In addition, you can define your own profiling functions in your code
by using the <code class="docutils literal"><span class="pre">Profile.profile_property</span></code> decorator:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@profile</span><span class="o">.</span><span class="n">Profile</span><span class="o">.</span><span class="n">profile_property</span>
<span class="k">def</span> <span class="nf">random</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
   <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbins</span><span class="p">)</span>
</pre></div>
</div>
<p>Now this will be automatically derivable for any newly-created profile as <code class="docutils literal"><span class="pre">'random'</span></code>.</p>
</div>
<div class="section" id="calculating-derivatives-and-dispersions">
<h2>Calculating Derivatives and Dispersions<a class="headerlink" href="#calculating-derivatives-and-dispersions" title="Permalink to this headline">¶</a></h2>
<p>You can calculate derivatives of profiles automatically. For instance,
you might be interested in d phi / dr if you’re looking at a
disk. This is as easy as attaching a <code class="docutils literal"><span class="pre">d_</span></code> to the profile name. For
example:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [10]: </span><span class="n">p_all</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="nb">min</span><span class="o">=</span><span class="s1">&#39;.01 kpc&#39;</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="s1">&#39;250 kpc&#39;</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">p_all</span><span class="p">[</span><span class="s1">&#39;pot&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="c1"># returns the potential profile</span>
<span class="gh">Out[11]: </span><span class="go"></span>
<span class="go">SimArray([-1883725.20606595, -1774955.42301467, -1722218.33725629,</span>
<span class="go">          -1690633.68613204, -1668854.69876006, -1652878.17689287,</span>
<span class="go">          -1640433.23593098, -1630243.6897215 , -1621605.13215668,</span>
<span class="go">          -1614220.3022136 ], &#39;km**2 s**-2&#39;)</span>

<span class="gp">In [12]: </span><span class="n">p_all</span><span class="p">[</span><span class="s1">&#39;d_pot&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span> <span class="c1"># returns d phi / dr from p[&quot;phi&quot;]</span>
<span class="gh">Out[12]: </span><span class="go"></span>
<span class="go">SimArray([ 43509.65360665,  32302.66586857,  16865.02197741,</span>
<span class="go">           10673.15462543,   7551.40390399,   5684.51994661,</span>
<span class="go">            4527.07851741,   3765.77138572,   3204.80569381,</span>
<span class="go">            2767.54060376], &#39;km**2 kpc**-1 s**-2&#39;)</span>
</pre></div>
</div>
<p>Similarly straightforward is the calculation of dispersions and
root-mean-square values. You simply need to attach a <code class="docutils literal"><span class="pre">_disp</span></code> or
<code class="docutils literal"><span class="pre">_rms</span></code> as a suffix to the profile name. To get the stellar velocity
dispersion:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [13]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s1">&#39;kpc&#39;</span><span class="p">),</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;vr_disp&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s1">&#39;km s^-1&#39;</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">hold</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gh">Out[13]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x1c2637e950&gt;]</span>

<span class="gp">In [14]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$R$ [kpc]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;$\sigma_{r}$&#39;</span><span class="p">)</span>
<span class="gh">Out[14]: </span><span class="go">Text(35.6378,0.5,&#39;$\\sigma_{r}$&#39;)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/profile_fig2.png"><img alt="../_images/profile_fig2.png" src="../_images/profile_fig2.png" style="width: 5in;" /></a>
<p>In addition to doing this by hand, you can make a
<a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.QuantileProfile" title="pynbody.analysis.profile.QuantileProfile"><code class="xref py py-class docutils literal"><span class="pre">QuantileProfile</span></code></a> that can return any
desired quantile range. By default, this is the mean +/- 1-sigma:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [15]: </span><span class="n">p_quant</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">QuantileProfile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="s1">&#39;0.1 kpc&#39;</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="s1">&#39;50 kpc&#39;</span><span class="p">)</span>

<span class="gp">In [16]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_quant</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">],</span> <span class="n">p_quant</span><span class="p">[</span><span class="s1">&#39;feh&#39;</span><span class="p">][:,</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gh">Out[16]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x1c253ae250&gt;]</span>

<span class="gp">In [17]: </span><span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">p_quant</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">],</span> <span class="n">p_quant</span><span class="p">[</span><span class="s1">&#39;feh&#39;</span><span class="p">][:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">p_quant</span><span class="p">[</span><span class="s1">&#39;feh&#39;</span><span class="p">][:,</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;Grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="gh">Out[17]: </span><span class="go">&lt;matplotlib.collections.PolyCollection at 0x1c250cfbd0&gt;</span>

<span class="gp">In [18]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$R$ [kpc]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;[Fe/H]&#39;</span><span class="p">)</span>
<span class="gh">Out[18]: </span><span class="go">Text(52.0128,0.5,&#39;[Fe/H]&#39;)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/profile_quant.png"><img alt="../_images/profile_quant.png" src="../_images/profile_quant.png" style="width: 5in;" /></a>
</div>
<div class="section" id="making-a-profile-using-a-different-quantity">
<h2>Making a profile using a different quantity<a class="headerlink" href="#making-a-profile-using-a-different-quantity" title="Permalink to this headline">¶</a></h2>
<p>Radial profiles are nice, but sometimes we want a “profile” using a
different quantity. We might want to know, for example, how the mean
metallicity varies as a function of age in the
stars. <a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile" title="pynbody.analysis.profile.Profile"><code class="xref py py-class docutils literal"><span class="pre">Profile</span></code></a> calls the function
<code class="xref py py-func docutils literal"><span class="pre">_calculate_x()</span></code> by default and
this simply returns the 3D or xy-plane radial distance, depending on
the value of <code class="docutils literal"><span class="pre">ndim</span></code>. We can specify a different function using the
<code class="docutils literal"><span class="pre">calc_x</span></code> keyword. Often these are simple so a lambda function can be
used (e.g. if we just want to return an array) or can also be more
complicated functions. For example, to make the profile of stars in
halo 1 according to their age:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [19]: </span><span class="n">s</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_units</span><span class="p">(</span><span class="s1">&#39;Gyr&#39;</span><span class="p">)</span>

<span class="gp">In [20]: </span><span class="n">p_age</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">Profile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="n">calc_x</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">s</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">],</span> <span class="nb">max</span> <span class="o">=</span> <span class="s1">&#39;10 Gyr&#39;</span><span class="p">)</span>

<span class="gp">In [21]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_age</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">],</span> <span class="n">p_age</span><span class="p">[</span><span class="s1">&#39;feh&#39;</span><span class="p">],</span> <span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;mean [Fe/H]&#39;</span><span class="p">,</span><span class="n">hold</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gh">Out[21]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x1c250e8fd0&gt;]</span>

<span class="gp">In [22]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_age</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">],</span> <span class="n">p_age</span><span class="p">[</span><span class="s1">&#39;feh_disp&#39;</span><span class="p">],</span> <span class="s1">&#39;k--&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;dispersion&#39;</span><span class="p">)</span>
<span class="gh">Out[22]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x1c250f4d10&gt;]</span>

<span class="gp">In [23]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Age [Gyr]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;[Fe/H]&#39;</span><span class="p">)</span>
<span class="gh">Out[23]: </span><span class="go">Text(45.6378,0.5,&#39;[Fe/H]&#39;)</span>

<span class="gp">In [24]: </span><span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="gh">Out[24]: </span><span class="go">&lt;matplotlib.legend.Legend at 0x1c26355090&gt;</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/profile_fig4.png"><img alt="../_images/profile_fig4.png" src="../_images/profile_fig4.png" style="width: 5in;" /></a>
</div>
<div class="section" id="vertical-profiles-and-inclined-profiles">
<h2>Vertical Profiles and Inclined Profiles<a class="headerlink" href="#vertical-profiles-and-inclined-profiles" title="Permalink to this headline">¶</a></h2>
<p>For analyzing disk structure, it is frequently useful to have a
profile in the z-direction. This is done with the
<a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.VerticalProfile" title="pynbody.analysis.profile.VerticalProfile"><code class="xref py py-class docutils literal"><span class="pre">VerticalProfile</span></code></a> which behaves in
the same way as the <a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.Profile" title="pynbody.analysis.profile.Profile"><code class="xref py py-class docutils literal"><span class="pre">Profile</span></code></a>. Unlike
in the basic class, you must specify the radial range and maximum z to
be used:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [25]: </span><span class="n">p_vert</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">VerticalProfile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="s1">&#39;3 kpc&#39;</span><span class="p">,</span> <span class="s1">&#39;5 kpc&#39;</span><span class="p">,</span> <span class="s1">&#39;5 kpc&#39;</span><span class="p">)</span>

<span class="gp">In [26]: </span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">p_vert</span><span class="p">[</span><span class="s1">&#39;rbins&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s1">&#39;pc&#39;</span><span class="p">),</span> <span class="n">p_vert</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s1">&#39;Msol pc^-3&#39;</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">hold</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="gh">Out[26]: </span><span class="go">[&lt;matplotlib.lines.Line2D at 0x1c502d0290&gt;]</span>

<span class="gp">In [27]: </span><span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$z$ [pc]&#39;</span><span class="p">);</span> <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\rho_{\star}$ [M$_{\odot}$ pc$^{-3}$]&#39;</span><span class="p">)</span>
<span class="gh">Out[27]: </span><span class="go">Text(45.6378,0.5,&#39;$\\rho_{\\star}$ [M$_{\\odot}$ pc$^{-3}$]&#39;)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/profile_fig5.png"><img alt="../_images/profile_fig5.png" src="../_images/profile_fig5.png" style="width: 5in;" /></a>
<p>Similarly, one can make inclined profiles using the
<a class="reference internal" href="../reference/analysis.html#pynbody.analysis.profile.VerticalProfile" title="pynbody.analysis.profile.VerticalProfile"><code class="xref py py-class docutils literal"><span class="pre">VerticalProfile</span></code></a>, but the snapshot needs to be rotated first:</p>
<div class="highlight-ipython"><div class="highlight"><pre><span></span><span class="gp">In [28]: </span><span class="n">s</span><span class="o">.</span><span class="n">rotate_x</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span> <span class="c1"># rotate the snapshot by 60-degrees</span>
<span class="gh">Out[28]: </span><span class="go">&lt;pynbody.transformation.GenericRotation at 0x1c24299a90&gt;</span>

<span class="gp">In [29]: </span><span class="n">p_inc</span> <span class="o">=</span> <span class="n">profile</span><span class="o">.</span><span class="n">InclinedProfile</span><span class="p">(</span><span class="n">h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">s</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="nb">min</span> <span class="o">=</span> <span class="s1">&#39;0.1 kpc&#39;</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="s1">&#39;50 kpc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/logo.svg" alt="Logo"/>
            </a></p>
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Profiles in Pynbody</a><ul>
<li><a class="reference internal" href="#radial-density-profile">Radial Density Profile</a></li>
<li><a class="reference internal" href="#the-profile-class">The Profile Class</a></li>
<li><a class="reference internal" href="#automatically-generated-profiles">Automatically-generated profiles</a></li>
<li><a class="reference internal" href="#calculating-derivatives-and-dispersions">Calculating Derivatives and Dispersions</a></li>
<li><a class="reference internal" href="#making-a-profile-using-a-different-quantity">Making a profile using a different quantity</a></li>
<li><a class="reference internal" href="#vertical-profiles-and-inclined-profiles">Vertical Profiles and Inclined Profiles</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="tutorials.html">Pynbody Tutorials</a><ul>
      <li>Previous: <a href="bridge.html" title="previous chapter">Tracing Particles between Snapshots</a></li>
      <li>Next: <a href="rotation_curve.html" title="next chapter">Plotting Rotation Cuves</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/tutorials/profile.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2011-18, pynbody team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.10</a>
      
      |
      <a href="../_sources/tutorials/profile.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>